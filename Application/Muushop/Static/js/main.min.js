"use strict";$(function(){var t=$('input[name="sort"]').val(),a=t.split("_");if("price"==a[0])var e=a[0],i=a[1];else e=a[0]+"_"+a[1],i=a[2];"all"==t&&(e="all"),$('div[data-type="sort-box"] a').each(function(){var t=$(this);t.removeClass("active"),e===t.data("name")&&(t.addClass("active"),"desc"===i&&t.find("i").addClass("icon icon-long-arrow-down"),"asc"===i&&t.find("i").addClass("icon icon-long-arrow-up"))})}),function(t){t.extend({get_cart_count:function(){var a=t('[data-toggle="cart_count"]').val();t.get(a,"",function(a){1==a.status&&t('[data-type="cart_count"] .cart_count').text(a.data)})},formatCurrency:function(t){return t=t.toString().replace(/\$|\,/g,""),isNaN(t)&&(t="0"),sign=t==(t=Math.abs(t)),t=Math.floor(100*t+.50000000001),cents=t%100,t=Math.floor(t/100).toString(),cents<10&&(cents="0"+cents),(sign?"":"-")+t+"."+cents},loadAddressData:function(a){t.get("/Muushop/api/address","",a,"json")}})}(jQuery),$.get_cart_count(),$(function(){$.loadAddressData(function(t){if(t.status){var a=t.data,e="";$.each(a,function(t,a){e+='<div class="address-box" data-id="'+a.id+'"><div class="address-info" data-type="address"><span class="title" data-id="'+a.id+'"><span class="address-user">'+a.name+"</span> "+a.phone+'<i></i></span><span class="info">'+a.province+" "+a.city+" "+a.district+" "+a.address+'</span><span class="edit"><a class="edit-address-btn" data-toggle="modal" data-remote="/muushop/user/address/action/edit/id/'+a.id+'">编辑</a> <a class="del-address-btn" data-toggle="modal" data-remote="/muushop/user/address/action/del/id/'+a.id+'">删除</a></span></div></div>'}),$(".address-main .address-list").html(e),$(".address-box .title:first").trigger("click")}else toast.error(t.info,"温馨提示")}),$(".address-list").on("mouseover",".address-box",function(){$(this).find(".edit").show()}),$(".address-list").on("mouseout",".address-box",function(){$(this).find(".edit").hide()})}),$(function(){var t=$('input[data-type="delivery_id"]').data("value"),a=$('input[data-type="real_quantity"]').data("value");$(".address-list").on("click",".address-box",function(){$(".address-box .title").removeClass("selected"),$(this).find(".title").addClass("selected");var e,i,s,n,d,r,o,c=$(this).data("id");e=".makeorder_address_box",i=$(".address-box").find(".selected").parents(".address-box"),s=$.trim($(i).find(".info").text()),n=$.trim($(i).find(".title").text()),d="<span>寄送至："+s+"</span><span>收件人："+n+"</span>",$(e).html(d),r=function(){var t=totalPrice();$('span[data-type="total_price"]').attr("data-value",t).html(t),ableScoreMore()},o={id:t,areaid:c,quantity:a,express:"express"},$.get("/Muushop/api/delivery",o,function(t){if(1==t.status){var a=t.data.delivery_fee;$("#freightPriceId i").text(a),r()}})}),$(".more-address").on("click",function(){$(".address-list").hasClass("in")?($(".address-list").removeClass("in"),$(this).find("span:first").text("更多地址"),$(this).find("span:eq(1)").html('<i class="icon icon-double-angle-down"></i>')):($(".address-list").addClass("in"),$(this).find("span:first").text("收起地址"),$(this).find("span:eq(1)").html('<i class="icon icon-double-angle-up"></i>'))})}),$(function(){$(".pay-type").click(function(){var t=$(this);$(".pay-type").removeClass("selected"),t.addClass("selected"),10==t.data("id")?($(".inline-pay-type").removeClass("hidden"),$(".inline-pay-type").addClass("display")):($(".inline-pay-type").removeClass("display"),$(".inline-pay-type").addClass("hidden"))}),$(".pay-section .pay-type:first").trigger("click")}),$(function(){$(".coupon-section h3 span").on("click",function(t){t.stopPropagation();var a=$(".coupon-main");a.hasClass("hidden")?(a.removeClass("hidden"),a.addClass("display")):(a.addClass("hidden"),a.removeClass("display"))}),$(".coupon-list-box").click(function(){var t=$(this);$(".coupon-list-box.selected").removeClass("selected"),t.addClass("selected"),cachBack();var a=totalPrice();$('span[data-type="total_price"]').attr("data-value",a).text(a)})});var ableScoreMore=function(){$('[data-type="score"]').each(function(){var t=$(this),a=t.find('[data-type="quantity"]').text(),e=t.find("[data-exchange]").data("exchange"),i=totalPrice()*e,s=parseInt(t.find("input").val());(""==s||isNaN(s))&&(s=0),i=a-s>i?i:a-s,t.find(".ableScoreNum").text(parseInt(i))})};function cachBack(){var t=0,a=0;$(".coupon-list-box.selected").data("value")&&(a=parseFloat($(".coupon-list-box.selected").data("value")));var e=0;$(".panel-body .return").each(function(){e+=parseFloat($(this).text())}),t=a+parseFloat(e),$("#cachBackId i").text(t.toFixed(2))}function totalPrice(){var t=parseFloat($("#warePriceId i").text());return(t=t-parseFloat($("#cachBackId i").text())+parseFloat($("#freightPriceId i").text()))<=0?0:t.toFixed(2)}$(function(){$(".panel-body input").bind("input propertychange",function(){$(this);var t=$("#warePriceId i").text(),a=$("#freightPriceId i").text(),e=parseInt(t)+parseInt(a),i=parseInt($(this).data("exchange")),s=parseInt($(this).val());s<=0&&($(this).val(0),s=0),isNaN(s)&&(s=0);var n=parseInt($(this).parent().parent().find('[data-type="quantity"]').text());s>parseFloat(n)&&$(this).val(n),console.log("总积分："+n+"|输入值:"+s);var d=0;$(this).parents().siblings('[data-type="score"]').each(function(){var t=$(this).find("input").val();""==t&&(t=0);var a=$(this).find("input").data("exchange");d+=t/a});var r=e-d;(r*=i)>n&&(r=n),parseFloat(s)>parseFloat(r)&&($(this).val(parseInt(r)),s=r),console.log(r);var o=s/i;$(this).parent().parent().find(".return").text(o.toFixed(2)),cachBack(),ableScoreMore(),$('span[data-type="total_price"]').attr("data-value",totalPrice()).text(totalPrice())})}),$(function(){var t=$('input[data-type="delivery_id"]').data("value");$(".makeorderBtn").click(function(){var a=$(".address-section .title.selected").data("id");if(a){var e=$(".pay-type.selected").data("id");if(10==e)var i=$(".paychannel.selected input").val();else i=1;var s=$(".coupon-list-box.selected").data("id"),n={};$('[data-type="score"] input').each(function(){var t=$(this).data("id");t&&(n["score"+t]=$(this).val())});var d={address_id:a,pay_type:e,channel:i,delivery_id:t,use_point:n,coupon_id:s,info:{remark:$(".remark-input").val()}},r=$('[data-type="cart_id"]').data("value");if(r)d.cart_id=r;else{var o={0:{sku_id:$('[data-type="product_skuid"]').data("value"),quantity:$('[data-type="product_quantity"]').data("value")}};d.products=o}$.post("/Muushop/order/makeorder",d,function(t){1==t.status?toast.success(t.info,"温馨提示"):(toast.error(t.info,"温馨提示"),setTimeout(function(){},1e3))})}else toast.error("收货地址未选择","温馨提示")})}),$(function(){var t=new Swiper(".view .swiper-container",{prevButton:".swiper-button-prev",nextButton:".swiper-button-next",onInit:function(t){$(".preview .swiper-slide:first").addClass("active-nav")},onSlideChangeStart:function(a){$(".preview .swiper-slide").removeClass("active-nav"),$(".preview .swiper-slide").each(function(){$(this).removeClass("active-nav"),$(this).data("id")==t.activeIndex+1&&$(this).addClass("active-nav")})}}),a=new Swiper(".preview .swiper-container",{visibilityFullFit:!0,slidesPerView:"auto",allowTouchMove:!1,onTap:function(){t.slideTo(a.clickedIndex)}})}),$(function(){var t=$('input[data-toggle="product_sku"]').val();t=$.parseJSON(t),$(".sku-content").Muusku({sku_data:t})}),$(function(){var t=$('input[data-toggle="product_sku"]').val();t=$.parseJSON(t),$(".buyImmediately").click(function(){var a=$('[data-type="title"]').data("id"),e=$(".count-input").val();if(e=isNaN(e)?1:e,t){var i=$(".sku-content").find("input").val();i?window.location.href="index.php?s=/muushop/order/makeorder&id="+a+"&quantity="+e+"&sku="+i:alert("请选择商品规格")}else window.location.href="index.php?s=/muushop/order/makeorder&id="+a+"&quantity="+e})}),$(function(){var t=$('input[data-toggle="product_sku"]').val();t=$.parseJSON(t),$(".addCartNow").click(function(){var a=$(".count-input").val();a=isNaN(a)?1:a;var e=$('[data-type="title"]').data("id");if(t){var i=$(".sku-content").find("input").val();if(!i)return void alert("请选择商品规格");e+=";"+i}var s={sku_id:e,quantity:a},n=$('input[data-toggle="add_cart_url"]').val();$.post(n,s,function(t){1==t.status?($.get_cart_count(),toast.success(t.info,"温馨提示")):toast.error(t.info,"温馨提示")})})}),$(function(){var t=$(".count-content .cut-btn"),a=$(".count-content .add-btn"),e=$(".count-content .count-input");t.click(function(){e.val()<=1||e.val(parseInt(e.val())-1)}),a.click(function(){var t=parseInt($(".quantity span").text());e.val()>=t||e.val(parseInt(e.val())+1)})}),$(function(){$('div[data-type="sort-box"] a').each(function(){var t=$(this);t.click(function(){alert("点了"+t.data("name"))})})}),function(t,a,e,i){var s=function(a,e){this.element=a,this.options=e,this.opts=t.extend({},this.DEFAULTS,e),this.init("muusku",a,e)};s.DEFAULTS={sku_data:""},s.prototype.init=function(a,e,i){var s=this;if(this.type=a,!this.opts.sku_data)return this.orderSku;this.quantity();var n={},d=e.find("li");d.click(function(){var a=[];t.each(s.opts.sku_data.table,function(t,e){a.push(t)});var i=t(this);i.parent().attr("data-sku");if(i.hasClass("no_sku"))delete n[i.attr("data-table")];else{d.hasClass("no_sku")&&delete n[i.attr("data-table")],n[i.attr("data-table")]=i.attr("data-value"),i.siblings().removeClass("selected"),i.addClass("selected"),d.removeClass("no_sku");var r={};a.forEach(function(t){r[t]=n[t]}),n=r;var o="";t.each(r,function(t,a){a?o+=";"+t+":"+a:a="",";"==o.substr(0,1)&&(o=o.substr(1))}),t.each(s.opts.sku_data.info,function(a,e){if((a=a.split(";")).indexOf(i.attr("data-table")+":"+i.attr("data-value"))>=0)for(var s=0;s<d.length;s++){var n=t(d[s]).attr("data-table")+":"+t(d[s]).attr("data-value");a.indexOf(n)>=0&&i.attr("data-table")!=t(d[s]).attr("data-table")&&(""!=e.quantity&&0!=e.quantity||(t(d[s]).removeClass("selected"),t(d[s]).addClass("no_sku")))}});for(var c=e.find("li.selected"),l="",u=0;u<c.length;u++)l+=";"+t(c[u]).attr("data-table")+":"+t(c[u]).attr("data-value");";"==l.substr(0,1)&&(l=l.substr(1)),s.skuQuery(l),s.quantity(l),s.price(l)}})},s.prototype.skuQuery=function(a){var e=this;t.each(this.opts.sku_data.info,function(t,i){t==a&&e.element.find("input").val(a)})},s.prototype.quantity=function(a){var e=0;return t.each(this.opts.sku_data.info,function(t,i){a?a.indexOf(";")>=0?t==a&&(e=parseInt(i.quantity)):(t=t.split(";")).indexOf(a)>=0&&(e+=parseInt(i.quantity)):e+=parseInt(i.quantity)}),t(".quantity span").text(e),e},s.prototype.price=function(a){a=t.trim(a);var e=0;t.each(this.opts.sku_data.info,function(i,s){i==a&&(e=s.price,t(".now-price").text(e))})},s.prototype.sku=function(t){return this.orderSku},t.fn.Muusku=function(t){new s(this,t);return this}}(jQuery,window,document);